"use strict";function _createForOfIteratorHelper(e,t){var r,n,i,o,a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(a)return n=!(r=!0),{s:function(){a=a.call(e)},n:function(){var e=a.next();return r=e.done,e},e:function(e){n=!0,i=e},f:function(){try{r||null==a.return||a.return()}finally{if(n)throw i}}};if(Array.isArray(e)||(a=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length)return a&&(e=a),o=0,{s:t=function(){},n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _regeneratorRuntime(){_regeneratorRuntime=function(){return a};var u,a={},e=Object.prototype,c=e.hasOwnProperty,l=Object.defineProperty||function(e,t,r){e[t]=r.value},t="function"==typeof Symbol?Symbol:{},n=t.iterator||"@@iterator",r=t.asyncIterator||"@@asyncIterator",i=t.toStringTag||"@@toStringTag";function o(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{o({},"")}catch(u){o=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var i,o,a,s,t=t&&t.prototype instanceof m?t:m,t=Object.create(t.prototype),n=new S(n||[]);return l(t,"_invoke",{value:(i=e,o=r,a=n,s=h,function(e,t){if(s===p)throw new Error("Generator is already running");if(s===y){if("throw"===e)throw t;return{value:u,done:!0}}for(a.method=e,a.arg=t;;){var r=a.delegate;if(r){r=function e(t,r){var n=r.method,i=t.iterator[n];if(i===u)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=u,e(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;n=f(i,t.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,v;i=n.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=u),r.delegate=null,v):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}(r,a);if(r){if(r===v)continue;return r}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(s===h)throw s=y,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);s=p;r=f(i,o,a);if("normal"===r.type){if(s=a.done?y:d,r.arg===v)continue;return{value:r.arg,done:a.done}}"throw"===r.type&&(s=y,a.method="throw",a.arg=r.arg)}})}),t}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}a.wrap=s;var h="suspendedStart",d="suspendedYield",p="executing",y="completed",v={};function m(){}function g(){}function _(){}var t={},b=(o(t,n,function(){return this}),Object.getPrototypeOf),b=b&&b(b(R([]))),x=(b&&b!==e&&c.call(b,n)&&(t=b),_.prototype=m.prototype=Object.create(t));function w(e){["next","throw","return"].forEach(function(t){o(e,t,function(e){return this._invoke(t,e)})})}function k(a,s){var t;l(this,"_invoke",{value:function(r,n){function e(){return new s(function(e,t){!function t(e,r,n,i){var o,e=f(a[e],a,r);if("throw"!==e.type)return(r=(o=e.arg).value)&&"object"==_typeof(r)&&c.call(r,"__await")?s.resolve(r.__await).then(function(e){t("next",e,n,i)},function(e){t("throw",e,n,i)}):s.resolve(r).then(function(e){o.value=e,n(o)},function(e){return t("throw",e,n,i)});i(e.arg)}(r,n,e,t)})}return t=t?t.then(e,e):e()}})}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function R(t){if(t||""===t){var r,e=t[n];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return r=-1,(e=function e(){for(;++r<t.length;)if(c.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=u,e.done=!0,e}).next=e}throw new TypeError(_typeof(t)+" is not iterable")}return l(x,"constructor",{value:g.prototype=_,configurable:!0}),l(_,"constructor",{value:g,configurable:!0}),g.displayName=o(_,i,"GeneratorFunction"),a.isGeneratorFunction=function(e){e="function"==typeof e&&e.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,o(e,i,"GeneratorFunction")),e.prototype=Object.create(x),e},a.awrap=function(e){return{__await:e}},w(k.prototype),o(k.prototype,r,function(){return this}),a.AsyncIterator=k,a.async=function(e,t,r,n,i){void 0===i&&(i=Promise);var o=new k(s(e,t,r,n),i);return a.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},w(x),o(x,i,"Generator"),o(x,n,function(){return this}),o(x,"toString",function(){return"[object Generator]"}),a.keys=function(e){var t,r=Object(e),n=[];for(t in r)n.push(t);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=R,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=u,this.done=!1,this.delegate=null,this.method="next",this.arg=u,this.tryEntries.forEach(A),!e)for(var t in this)"t"===t.charAt(0)&&c.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=u)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function e(e,t){return o.type="throw",o.arg=r,n.next=e,t&&(n.method="next",n.arg=u),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var i=this.tryEntries[t],o=i.completion;if("root"===i.tryLoc)return e("end");if(i.tryLoc<=this.prev){var a=c.call(i,"catchLoc"),s=c.call(i,"finallyLoc");if(a&&s){if(this.prev<i.catchLoc)return e(i.catchLoc,!0);if(this.prev<i.finallyLoc)return e(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return e(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return e(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&c.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}var o=(i=i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc?null:i)?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r,n,i=this.tryEntries[t];if(i.tryLoc===e)return"throw"===(r=i.completion).type&&(n=r.arg,A(i)),n}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:R(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=u),v}},a}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var r;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(r="Object"===(r=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,s=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function asyncGeneratorStep(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,i)}function _asyncToGenerator(s){return function(){var e=this,a=arguments;return new Promise(function(t,r){var n=s.apply(e,a);function i(e){asyncGeneratorStep(n,t,r,i,o,"next",e)}function o(e){asyncGeneratorStep(n,t,r,i,o,"throw",e)}i(void 0)})}}function ownKeys(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"===_typeof(e)?e:String(e)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!==_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}!function(){var c={staleTTL:6e4,cacheKey:"gbFeaturesCache",backgroundSync:!0,maxEntries:10,disableIdleStreams:!1,idleStreamInterval:2e4},l={fetch:globalThis.fetch?globalThis.fetch.bind(globalThis):void 0,SubtleCrypto:globalThis.crypto?globalThis.crypto.subtle:void 0,EventSource:globalThis.EventSource},f={fetchFeaturesCall:function(e){var t=e.host,r=e.clientKey,e=e.headers;return l.fetch("".concat(t,"/api/features/").concat(r),{headers:e})},fetchRemoteEvalCall:function(e){var t=e.host,r=e.clientKey,n=e.payload,e={method:"POST",headers:_objectSpread({"Content-Type":"application/json"},e.headers),body:JSON.stringify(n)};return l.fetch("".concat(t,"/api/eval/").concat(r),e)},eventSourceCall:function(e){var t=e.host,r=e.clientKey,e=e.headers;return e?new l.EventSource("".concat(t,"/sub/").concat(r),{headers:e}):new l.EventSource("".concat(t,"/sub/").concat(r))},startIdleListener:function(){var e,t;if("undefined"!=typeof window&&"undefined"!=typeof document)return t=function(){"visible"===document.visibilityState?(window.clearTimeout(e),y.forEach(function(e){e&&"idle"===e.state&&b(e)})):"hidden"===document.visibilityState&&(e=window.setTimeout(P,c.idleStreamInterval))},document.addEventListener("visibilitychange",t),function(){return document.removeEventListener("visibilitychange",t)}},stopIdleListener:function(){}};try{globalThis.localStorage&&(l.localStorage=globalThis.localStorage)}catch(e){}var h=new Map,r=!1,d=new Map,p=new Map,y=new Map,v=new Set;function s(){return(s=_asyncToGenerator(_regeneratorRuntime().mark(function e(t,r,n,i,o,a){var s;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a||(c.backgroundSync=!1),e.next=3,function(){return $.apply(this,arguments)}(t,i,r,n);case 3:if(s=e.sent,e.t0=o&&s,e.t0)return e.next=8,U(t,s);e.next=8;break;case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}function P(){y.forEach(function(e){e&&(e.state="idle",z(e))})}function H(){N.apply(this,arguments)}function N(){return(N=_asyncToGenerator(_regeneratorRuntime().mark(function e(){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,l.localStorage){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,l.localStorage.setItem(c.cacheKey,JSON.stringify(Array.from(d.entries())));case 5:e.next=9;break;case 7:e.prev=7,e.t0=e.catch(0);case 9:case"end":return e.stop()}},e,null,[[0,7]])}))).apply(this,arguments)}function $(){return($=_asyncToGenerator(_regeneratorRuntime().mark(function e(t,r,n,a){var s,u,c,l;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=m(t),u=g(t),c=new Date,e.next=5,function(){return K.apply(this,arguments)}();case 5:if((l=d.get(u))&&!a&&(r||l.staleAt>c))return l.sse&&v.add(s),(l.staleAt<c?_:q)(t),e.abrupt("return",l.data);e.next=12;break;case 12:e.next=14;var i=_(t),o=n;return new Promise(function(t){function e(e){n||(n=!0,r&&clearTimeout(r),t(e||null))}var r,n=!1;o&&(r=setTimeout(function(){return e()},o)),i.then(e).catch(function(){return e()})});case 14:return e.abrupt("return",e.sent);case 15:case"end":return e.stop()}},e)}))).apply(this,arguments)}function m(e){var e=_slicedToArray(e.getApiInfo(),2),t=e[0],e=e[1];return"".concat(t,"||").concat(e)}function g(e){var t,r,n,i=m(e);return e.isRemoteEval()?(t=e.getAttributes(),n=e.getCacheKeyAttributes()||Object.keys(e.getAttributes()),r={},n.forEach(function(e){r[e]=t[e]}),n=e.getForcedVariations(),e=e.getUrl(),"".concat(i,"||").concat(JSON.stringify({ca:r,fv:n,url:e}))):i}function K(){return(K=_asyncToGenerator(_regeneratorRuntime().mark(function e(){var t;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r)return e.abrupt("return");e.next=2;break;case 2:if(r=!0,e.prev=3,l.localStorage)return e.next=7,l.localStorage.getItem(c.cacheKey);e.next=9;break;case 7:(t=e.sent)&&((t=JSON.parse(t))&&Array.isArray(t)&&t.forEach(function(e){var e=_slicedToArray(e,2),t=e[0],e=e[1];d.set(t,_objectSpread(_objectSpread({},e),{},{staleAt:new Date(e.staleAt)}))}),M());case 9:e.next=13;break;case 11:e.prev=11,e.t0=e.catch(3);case 13:c.disableIdleStreams||(t=f.startIdleListener())&&(f.stopIdleListener=t);case 14:case"end":return e.stop()}},e,null,[[3,11]])}))).apply(this,arguments)}function M(){for(var e=Array.from(d.entries()).map(function(e){e=_slicedToArray(e,2);return{key:e[0],staleAt:e[1].staleAt.getTime()}}).sort(function(e,t){return e.staleAt-t.staleAt}),t=Math.min(Math.max(0,d.size-c.maxEntries),d.size),r=0;r<t;r++)d.delete(e[r].key)}function G(e,t,r){var n=r.dateUpdated||"",i=new Date(Date.now()+c.staleTTL),o=d.get(t);o&&n&&o.version===n?(o.staleAt=i,H()):(d.set(t,{data:r,version:n,staleAt:i,sse:v.has(e)}),M(),H(),(o=h.get(e))&&o.forEach(function(e){return U(e,r)}))}function U(){return D.apply(this,arguments)}function D(){return(D=_asyncToGenerator(_regeneratorRuntime().mark(function e(t,r){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.encryptedExperiments?t.setEncryptedExperiments(r.encryptedExperiments,void 0,l.SubtleCrypto):t.setExperiments(r.experiments||t.getExperiments());case 2:return e.next=4,r.encryptedFeatures?t.setEncryptedFeatures(r.encryptedFeatures,void 0,l.SubtleCrypto):t.setFeatures(r.features||t.getFeatures());case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function _(){return B.apply(this,arguments)}function B(){return(B=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){var r,n,i,o,a,s,u;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.getApiHosts(),r=n.apiHost,n=n.apiRequestHeaders,i=t.getClientKey(),u=t.isRemoteEval(),o=m(t),a=g(t),(s=p.get(a))||(u=u?f.fetchRemoteEvalCall({host:r,clientKey:i,payload:{attributes:t.getAttributes(),forcedVariations:t.getForcedVariations(),forcedFeatures:Array.from(t.getForcedFeatures().entries()),url:t.getUrl()},headers:n}):f.fetchFeaturesCall({host:r,clientKey:i,headers:n}),s=u.then(function(e){return"enabled"===e.headers.get("x-sse-support")&&v.add(o),e.json()}).then(function(e){return G(o,a,e),q(t),p.delete(a),e}).catch(function(e){return t.log("Error fetching features",{apiHost:r,clientKey:i,error:e?e.message:null}),p.delete(a),Promise.resolve({})}),p.set(a,s)),e.next=9,s;case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}},e)}))).apply(this,arguments)}function q(n){var i,o=m(n),a=g(n),e=n.getApiHosts(),s=e.streamingHost,e=e.streamingHostRequestHeaders,u=n.getClientKey();c.backgroundSync&&v.has(o)&&l.EventSource&&(y.has(o)||(i={src:null,host:s,clientKey:u,headers:e,cb:function(e){try{var t,r;"features-updated"===e.type?(t=h.get(o))&&t.forEach(function(e){_(e)}):"features"===e.type&&(r=JSON.parse(e.data),G(o,a,r)),i.errors=0}catch(e){n.log("SSE Error",{streamingHost:s,clientKey:u,error:e?e.message:null}),J(i)}},errors:0,state:"active"},y.set(o,i),b(i)))}function J(e){var t;"idle"!==e.state&&(e.errors++,3<e.errors||e.src&&2===e.src.readyState)&&(t=Math.pow(3,e.errors-3)*(1e3+1e3*Math.random()),z(e),setTimeout(function(){["idle","active"].includes(e.state)||b(e)},Math.min(t,3e5)))}function z(e){e.src&&(e.src.onopen=null,e.src.onerror=null,e.src.close(),e.src=null,"active"===e.state)&&(e.state="disabled")}function b(e){e.src=f.eventSourceCall({host:e.host,clientKey:e.clientKey,headers:e.headers}),e.state="active",e.src.addEventListener("features",e.cb),e.src.addEventListener("features-updated",e.cb),e.src.onerror=function(){return J(e)},e.src.onopen=function(){e.errors=0}}var Q=/^[a-zA-Z:_][a-zA-Z0-9:_.-]*$/,u={revert:function(){}},a=new Map,t=new Set;function o(e){var t=a.get(e);return t||a.set(e,t={element:e,attributes:{}}),t}function x(t,r,n,e,i){var o=n(t),a={isDirty:!1,originalValue:o,virtualValue:o,mutations:[],el:t,_positionTimeout:null,observer:new MutationObserver(function(){var e;"position"===r&&a._positionTimeout||("position"===r&&(a._positionTimeout=setTimeout(function(){a._positionTimeout=null},1e3)),e=n(t),"position"===r&&e.parentNode===a.virtualValue.parentNode&&e.insertBeforeNode===a.virtualValue.insertBeforeNode)||e!==a.virtualValue&&(a.originalValue=e,i(a))}),mutationRunner:i,setValue:e,getCurrentValue:n};return"position"===r&&t.parentNode?a.observer.observe(t.parentNode,{childList:!0,subtree:!0,attributes:!1,characterData:!1}):a.observer.observe(t,"html"===(o=r)?{childList:!0,subtree:!0,attributes:!0,characterData:!0}:{childList:!1,subtree:!1,attributes:!0,attributeFilter:[o]}),a}function i(e,t){var r=t.getCurrentValue(t.el);(t.virtualValue=e)&&"string"!=typeof e?r&&e.parentNode===r.parentNode&&e.insertBeforeNode===r.insertBeforeNode||(t.isDirty=!0,fe()):e!==r&&(t.isDirty=!0,fe())}function W(e){var t=e.originalValue;e.mutations.forEach(function(e){return t=e.mutate(t)}),i(function(e){n=n||document.createElement("div");return n.innerHTML=e,n.innerHTML}(t),e)}function Y(e){var t=new Set(e.originalValue.split(/\s+/).filter(Boolean));e.mutations.forEach(function(e){return e.mutate(t)}),i(Array.from(t).filter(Boolean).join(" "),e)}function Z(e){var t=e.originalValue;e.mutations.forEach(function(e){return t=e.mutate(t)}),i(t,e)}function X(e){var n=e.originalValue;e.mutations.forEach(function(e){var t,r,e=e.mutate(),e=(r=(e=e).parentSelector,e=e.insertBeforeSelector,!(r=document.querySelector(r))||(t=e?document.querySelector(e):null,e&&!t)?null:{parentNode:r,insertBeforeNode:t});n=e||n}),i(n,e)}function ee(e){return e.innerHTML}function te(e,t){return e.innerHTML=t}function re(e){var t=o(e);return t.html||(t.html=x(e,"html",ee,te,W)),t.html}function ne(e){return{parentNode:e.parentElement,insertBeforeNode:e.nextElementSibling}}function ie(e,t){t.insertBeforeNode&&!t.parentNode.contains(t.insertBeforeNode)||t.parentNode.insertBefore(e,t.insertBeforeNode)}function oe(e){var t=o(e);return t.position||(t.position=x(e,"position",ne,ie,X)),t.position}function ae(e,t){return t?e.className=t:e.removeAttribute("class")}function se(e){return e.className}function ue(e){var t=o(e);return t.classes||(t.classes=x(e,"class",se,ae,Y)),t.classes}var n,e;function ce(e,t){var r,n,i=o(e);return i.attributes[t]||(i.attributes[t]=x(e,t,function(e){return null!=(e=e.getAttribute(n))?e:null},(r=n=t,function(e,t){return null!==t?e.setAttribute(r,t):e.removeAttribute(r)}),Z)),i.attributes[t]}function w(e,t,r){var n,i,o;r.isDirty&&(r.isDirty=!1,n=r.virtualValue,!r.mutations.length&&(i=e,t=t,i=a.get(i))&&("html"===t?(null!=(o=i.html)&&null!=(o=o.observer)&&o.disconnect(),delete i.html):"class"===t?(null!=(o=i.classes)&&null!=(o=o.observer)&&o.disconnect(),delete i.classes):"position"===t?(null!=(o=i.position)&&null!=(o=o.observer)&&o.disconnect(),delete i.position):(null!=(o=i.attributes)&&null!=(o=o[t])&&null!=(o=o.observer)&&o.disconnect(),delete i.attributes[t])),r.setValue(e,n))}function le(t,r){t.html&&w(r,"html",t.html),t.classes&&w(r,"class",t.classes),t.position&&w(r,"position",t.position),Object.keys(t.attributes).forEach(function(e){w(r,e,t.attributes[e])})}function fe(){a.forEach(le)}function he(n){var i;"position"===n.kind&&1===n.elements.size||(i=new Set(n.elements),document.querySelectorAll(n.selector).forEach(function(e){var t,r;i.has(e)||(n.elements.add(e),e=e,r=null,"html"===(t=n).kind?r=re(e):"class"===t.kind?r=ue(e):"attribute"===t.kind?r=ce(e,t.attribute):"position"===t.kind&&(r=oe(e)),r&&(r.mutations.push(t),r.mutationRunner(r)))}))}function de(n){n.elements.forEach(function(e){return e=e,r=null,"html"===(t=n).kind?r=re(e):"class"===t.kind?r=ue(e):"attribute"===t.kind?r=ce(e,t.attribute):"position"===t.kind&&(r=oe(e)),void(r&&(-1!==(e=r.mutations.indexOf(t))&&r.mutations.splice(e,1),r.mutationRunner(r)));var t,r}),n.elements.clear(),t.delete(n)}function pe(){t.forEach(he)}function k(e){return"undefined"==typeof document?u:(t.add(e),he(e),{revert:function(){de(e)}})}function E(e,t){return k({kind:"html",elements:new Set,mutate:t,selector:e})}function ye(e,t){return k({kind:"position",elements:new Set,mutate:t,selector:e})}function A(e,t){return k({kind:"class",elements:new Set,mutate:t,selector:e})}function S(e,t,r){return Q.test(t)?"class"===t||"className"===t?A(e,function(t){var e=r(Array.from(t).join(" "));t.clear(),e&&e.split(/\s+/g).filter(Boolean).forEach(function(e){return t.add(e)})}):k({kind:"attribute",attribute:t,elements:new Set,mutate:r,selector:e}):u}"undefined"!=typeof document&&(e=e||new MutationObserver(function(){pe()}),pe(),e.observe(document.documentElement,{childList:!0,subtree:!0,attributes:!1,characterData:!1}));var ve={html:E,classes:A,attribute:S,position:ye,declarative:function(e){var t=e.selector,r=e.action,n=e.value,i=e.attribute,o=e.parentSelector,a=e.insertBeforeSelector;if("html"===i){if("append"===r)return E(t,function(e){return e+(null!=n?n:"")});if("set"===r)return E(t,function(){return null!=n?n:""})}else if("class"===i){if("append"===r)return A(t,function(e){n&&e.add(n)});if("remove"===r)return A(t,function(e){n&&e.delete(n)});if("set"===r)return A(t,function(e){e.clear(),n&&e.add(n)})}else if("position"===i){if("set"===r&&o)return ye(t,function(){return{insertBeforeSelector:a,parentSelector:o}})}else{if("append"===r)return S(t,i,function(e){return null!==e?e+(null!=n?n:""):null!=n?n:""});if("set"===r)return S(t,i,function(){return null!=n?n:""});if("remove"===r)return S(t,i,function(){return null})}return u}};function R(e){for(var t=2166136261,r=e.length,n=0;n<r;n++)t=(t^=e.charCodeAt(n))+((t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24));return t>>>0}function T(e,t,r){return 2===r?R(R(e+t)+"")%1e4/1e4:1===r?R(t+e)%1e3/1e3:null}function F(e,t){return e>=t[0]&&e<t[1]}function me(e){try{var t=e.replace(/([^\\])\//g,"$1\\/");return new RegExp(t)}catch(e){console.error(e)}}function ge(e,t){if(t.length){for(var r=!1,n=!1,i=0;i<t.length;i++){var o=function(e,t,r){try{var n,i=new URL(e,"https://_");return"regex"===t?!!(n=me(r))&&(n.test(i.href)||n.test(i.href.substring(i.origin.length))):"simple"===t&&function(r,e){try{var t=new URL(e.replace(/^([^:/?]*)\./i,"https://$1.").replace(/\*/g,"_____"),"https://_____"),n=[[r.host,t.host,!1],[r.pathname,t.pathname,!0]];return t.hash&&n.push([r.hash,t.hash,!1]),t.searchParams.forEach(function(e,t){n.push([r.searchParams.get(t)||"",e,!1])}),!n.some(function(e){var t=e[0],r=e[1],e=e[2];try{var n=r.replace(/[*.+?^${}()|[\]\\]/g,"\\$&").replace(/_____/g,".*");return!(e&&(n="\\/?"+n.replace(/(^\/|\/$)/g,"")+"\\/?"),new RegExp("^"+n+"$","i").test(t))}catch(e){}return!0})}catch(e){return!1}}(i,r)}catch(e){return!1}}(e,t[i].type,t[i].pattern);if(!1===t[i].include){if(o)return}else r=!0,o&&(n=!0)}return n||!r}}function _e(e,r,t){(r=void 0===r?1:r)<0?(console.error("Experiment.coverage must be greater than or equal to 0"),r=0):1<r&&(console.error("Experiment.coverage must be less than or equal to 1"),r=1);var n=(n=e)<=0?[]:new Array(n).fill(1/n),e=((t=t||n).length!==e&&(console.error("Experiment.weights array must be the same length as Experiment.variations"),t=n),t.reduce(function(e,t){return t+e},0)),i=((e<.99||1.01<e)&&(console.error("Experiment.weights must add up to 1"),t=n),0);return t.map(function(e){var t=i;return i+=e,[t,t+r*e]})}var O=function(e){return Uint8Array.from(atob(e),function(e){return e.charCodeAt(0)})};function be(){return xe.apply(this,arguments)}function xe(){return(xe=_asyncToGenerator(_regeneratorRuntime().mark(function e(t,r,n){var i,o,a;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=r||"",n=n||globalThis.crypto&&globalThis.crypto.subtle){e.next=4;break}throw new Error("No SubtleCrypto implementation found");case 4:return e.prev=4,e.next=7,n.importKey("raw",O(r),{name:"AES-CBC",length:128},!0,["encrypt","decrypt"]);case 7:return i=e.sent,o=t.split("."),o=_slicedToArray(o,2),a=o[0],o=o[1],e.next=11,n.decrypt({name:"AES-CBC",iv:O(a)},i,O(o));case 11:return a=e.sent,e.abrupt("return",(new TextDecoder).decode(a));case 15:throw e.prev=15,e.t0=e.catch(4),new Error("Failed to decrypt");case 18:case"end":return e.stop()}},e,null,[[4,15]])}))).apply(this,arguments)}function C(e){"number"==typeof e&&(e+="");e=(e=e&&"string"==typeof e?e:"0").replace(/(^v|\+.*$)/g,"").split(/[-.]/);return 3===e.length&&e.push("~"),e.map(function(e){return e.match(/^[0-9]+$/)?e.padStart(5," "):e}).join("-")}var L={};function j(e,t){if("$or"in t)return Ee(e,t.$or);if("$nor"in t)return!Ee(e,t.$nor);if("$and"in t){for(var r=e,n=t.$and,i=0;i<n.length;i++)if(!j(r,n[i]))return!1}else{if("$not"in t)return!j(e,t.$not);for(var o=0,a=Object.entries(t);o<a.length;o++){var s=_slicedToArray(a[o],2),u=s[0];if(!V(s[1],function(e,t){for(var r=t.split("."),n=e,i=0;i<r.length;i++){if(!(n&&"object"===_typeof(n)&&r[i]in n))return null;n=n[r[i]]}return n}(e,u)))return!1}}return!0}function V(e,t){if("string"==typeof e)return t+""===e;if("number"==typeof e)return+t===e;if("boolean"==typeof e)return!!t===e;if(null===e)return null===t;if(Array.isArray(e)||!we(e))return JSON.stringify(t)===JSON.stringify(e);for(var r in e)if(!function(e,t,r){switch(e){case"$veq":return C(t)===C(r);case"$vne":return C(t)!==C(r);case"$vgt":return C(t)>C(r);case"$vgte":return C(t)>=C(r);case"$vlt":return C(t)<C(r);case"$vlte":return C(t)<=C(r);case"$eq":return t===r;case"$ne":return t!==r;case"$lt":return t<r;case"$lte":return t<=r;case"$gt":return r<t;case"$gte":return r<=t;case"$exists":return r?null!=t:null==t;case"$in":return Array.isArray(r)?ke(t,r):void 0;case"$nin":return Array.isArray(r)?!ke(t,r):void 0;case"$not":return!V(r,t);case"$size":return Array.isArray(t)?V(r,t.length):void 0;case"$elemMatch":return function(e,t){if(Array.isArray(e))for(var r=we(t)?function(e){return V(t,e)}:function(e){return j(e,t)},n=0;n<e.length;n++)if(e[n]&&r(e[n]))return 1;return}(t,r);case"$all":if(!Array.isArray(t))return;for(var n=0;n<r.length;n++){for(var i=!1,o=0;o<t.length;o++)if(V(r[n],t[o])){i=!0;break}if(!i)return}return 1;case"$regex":try{return function(e){return L[e]||(L[e]=new RegExp(e.replace(/([^\\])\//g,"$1\\/"))),L[e]}(r).test(t)}catch(e){return}case"$type":return function(e){if(null===e)return"null";if(Array.isArray(e))return"array";e=_typeof(e);if(["string","number","boolean","object","undefined"].includes(e))return e;return"unknown"}(t)===r;default:return void console.error("Unknown operator: "+e)}}(r,t,e[r]))return!1;return!0}function we(e){e=Object.keys(e);return 0<e.length&&e.filter(function(e){return"$"===e[0]}).length===e.length}function ke(e,t){return Array.isArray(e)?e.some(function(e){return t.includes(e)}):t.includes(e)}function Ee(e,t){if(!t.length)return!0;for(var r=0;r<t.length;r++)if(j(e,t[r]))return!0;return!1}var I="undefined"!=typeof window&&"undefined"!=typeof document,Ae=function(){var t;try{t="0.30.0"}catch(e){t=""}return t}(),Se=function(){function r(e){if(_classCallCheck(this,r),e=e||{},this.version=Ae,this._ctx=this.context=e,this._renderer=null,this._trackedExperiments=new Set,this._trackedFeatures={},this.debug=!1,this._subscriptions=new Set,this._rtQueue=[],this._rtTimer=0,this.ready=!1,this._assigned=new Map,this._forcedFeatureValues=new Map,this._attributeOverrides={},this._activeAutoExperiments=new Map,this._loadFeaturesCalled=!1,e.remoteEval){if(e.decryptionKey)throw new Error("Encryption is not available for remoteEval");if(!e.clientKey)throw new Error("Missing clientKey");var t=!1;try{t=!!new URL(e.apiHost||"").hostname.match(/growthbook\.io$/i)}catch(e){}if(t)throw new Error("Cannot use remoteEval on GrowthBook Cloud")}else if(e.cacheKeyAttributes)throw new Error("cacheKeyAttributes are only used for remoteEval");e.features&&(this.ready=!0),I&&e.enableDevMode&&(window._growthbook=this,document.dispatchEvent(new Event("gbloaded"))),e.experiments&&(this.ready=!0,this._updateAllAutoExperiments()),e.clientKey&&!e.remoteEval&&this._refresh({},!0,!1)}var e,n,i,o,t,a;return _createClass(r,[{key:"loadFeatures",value:(a=_asyncToGenerator(_regeneratorRuntime().mark(function e(i){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i&&i.autoRefresh&&(this._ctx.subscribeToChanges=!0),this._loadFeaturesCalled=!0,e.next=4,this._refresh(i,!0,!0);case 4:this._canSubscribe()&&(n=r=void 0,r=m(t=this),(n=h.get(r)||new Set).add(t),h.set(r,n));case 5:case"end":return e.stop()}var t,r,n},e,this)})),function(e){return a.apply(this,arguments)})},{key:"refreshFeatures",value:(t=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._refresh(t,!1,!0);case 2:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"getApiInfo",value:function(){return[this.getApiHosts().apiHost,this.getClientKey()]}},{key:"getApiHosts",value:function(){var e=this._ctx.apiHost||"https://cdn.growthbook.io";return{apiHost:e.replace(/\/*$/,""),streamingHost:(this._ctx.streamingHost||e).replace(/\/*$/,""),apiRequestHeaders:this._ctx.apiHostRequestHeaders,streamingHostRequestHeaders:this._ctx.streamingHostRequestHeaders}}},{key:"getClientKey",value:function(){return this._ctx.clientKey||""}},{key:"isRemoteEval",value:function(){return this._ctx.remoteEval||!1}},{key:"getCacheKeyAttributes",value:function(){return this._ctx.cacheKeyAttributes}},{key:"_refresh",value:(o=_asyncToGenerator(_regeneratorRuntime().mark(function e(t,r,n){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=t||{},this._ctx.clientKey){e.next=3;break}throw new Error("Missing clientKey");case 3:return e.next=5,function(){return s.apply(this,arguments)}(this,t.timeout,t.skipCache||this._ctx.enableDevMode,r,n,!1!==this._ctx.backgroundSync);case 5:case"end":return e.stop()}},e,this)})),function(e,t,r){return o.apply(this,arguments)})},{key:"_render",value:function(){this._renderer&&this._renderer()}},{key:"setFeatures",value:function(e){this._ctx.features=e,this.ready=!0,this._render()}},{key:"setEncryptedFeatures",value:(i=_asyncToGenerator(_regeneratorRuntime().mark(function e(t,r,n){var i;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,be(t,r||this._ctx.decryptionKey,n);case 2:i=e.sent,this.setFeatures(JSON.parse(i));case 4:case"end":return e.stop()}},e,this)})),function(e,t,r){return i.apply(this,arguments)})},{key:"setExperiments",value:function(e){this._ctx.experiments=e,this.ready=!0,this._updateAllAutoExperiments()}},{key:"setEncryptedExperiments",value:(n=_asyncToGenerator(_regeneratorRuntime().mark(function e(t,r,n){var i;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,be(t,r||this._ctx.decryptionKey,n);case 2:i=e.sent,this.setExperiments(JSON.parse(i));case 4:case"end":return e.stop()}},e,this)})),function(e,t,r){return n.apply(this,arguments)})},{key:"setAttributes",value:function(e){this._ctx.attributes=e,this._ctx.remoteEval?this._refreshForRemoteEval():(this._render(),this._updateAllAutoExperiments())}},{key:"setAttributeOverrides",value:function(e){this._attributeOverrides=e,this._ctx.remoteEval?this._refreshForRemoteEval():(this._render(),this._updateAllAutoExperiments())}},{key:"setForcedVariations",value:function(e){this._ctx.forcedVariations=e||{},this._ctx.remoteEval?this._refreshForRemoteEval():(this._render(),this._updateAllAutoExperiments())}},{key:"setForcedFeatures",value:function(e){this._forcedFeatureValues=e,this._render()}},{key:"setURL",value:function(e){var t=this;this._ctx.url=e,this._ctx.remoteEval?this._refreshForRemoteEval().then(function(){return t._updateAllAutoExperiments(!0)}):this._updateAllAutoExperiments(!0)}},{key:"getAttributes",value:function(){return _objectSpread(_objectSpread({},this._ctx.attributes),this._attributeOverrides)}},{key:"getForcedVariations",value:function(){return this._ctx.forcedVariations||{}}},{key:"getForcedFeatures",value:function(){return this._forcedFeatureValues||new Map}},{key:"getUrl",value:function(){return this._ctx.url||""}},{key:"getFeatures",value:function(){return this._ctx.features||{}}},{key:"getExperiments",value:function(){return this._ctx.experiments||[]}},{key:"subscribe",value:function(e){var t=this;return this._subscriptions.add(e),function(){t._subscriptions.delete(e)}}},{key:"_canSubscribe",value:function(){return!1!==this._ctx.backgroundSync&&this._ctx.subscribeToChanges}},{key:"_refreshForRemoteEval",value:(e=_asyncToGenerator(_regeneratorRuntime().mark(function e(){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._ctx.remoteEval){e.next=2;break}return e.abrupt("return");case 2:if(this._loadFeaturesCalled){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,this._refresh({},!1,!0).catch(function(){});case 6:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"getAllResults",value:function(){return new Map(this._assigned)}},{key:"destroy",value:function(){var t;this._subscriptions.clear(),this._assigned.clear(),this._trackedExperiments.clear(),this._trackedFeatures={},this._rtQueue=[],this._rtTimer&&clearTimeout(this._rtTimer),t=this,h.forEach(function(e){return e.delete(t)}),I&&window._growthbook===this&&delete window._growthbook,this._activeAutoExperiments.forEach(function(e){e.undo()}),this._activeAutoExperiments.clear()}},{key:"setRenderer",value:function(e){this._renderer=e}},{key:"forceVariation",value:function(e,t){this._ctx.forcedVariations=this._ctx.forcedVariations||{},this._ctx.forcedVariations[e]=t,this._ctx.remoteEval?this._refreshForRemoteEval():(this._updateAllAutoExperiments(),this._render())}},{key:"run",value:function(e){var t=this._run(e,null);return this._fireSubscriptions(e,t),t}},{key:"triggerExperiment",value:function(t){var e;return this._ctx.experiments&&(e=this._ctx.experiments.find(function(e){return e.key===t}))&&e.manual?this._runAutoExperiment(e,!0):null}},{key:"_runAutoExperiment",value:function(e,t,r){var n,i=e.key,o=this._activeAutoExperiments.get(i);return!e.manual||t||o?(t=this.run(e),n=JSON.stringify(t.value),!r&&t.inExperiment&&o&&o.valueHash===n||(o&&this._undoActiveAutoExperiment(i),t.inExperiment&&(r=this._applyDOMChanges(t.value))&&this._activeAutoExperiments.set(e.key,{undo:r,valueHash:n})),t):null}},{key:"_undoActiveAutoExperiment",value:function(e){var t=this._activeAutoExperiments.get(e);t&&(t.undo(),this._activeAutoExperiments.delete(e))}},{key:"_updateAllAutoExperiments",value:function(t){var r=this,e=this._ctx.experiments||[],n=new Set(e.map(function(e){return e.key}));this._activeAutoExperiments.forEach(function(e,t){n.has(t)||(e.undo(),r._activeAutoExperiments.delete(t))}),e.forEach(function(e){r._runAutoExperiment(e,!1,t)})}},{key:"_fireSubscriptions",value:function(t,r){var e=t.key,n=this._assigned.get(e);n&&n.result.inExperiment===r.inExperiment&&n.result.variationId===r.variationId||(this._assigned.set(e,{experiment:t,result:r}),this._subscriptions.forEach(function(e){try{e(t,r)}catch(e){console.error(e)}}))}},{key:"_trackFeatureUsage",value:function(e,t){var r=this;if("override"!==t.source){var n=JSON.stringify(t.value);if(this._trackedFeatures[e]!==n){if(this._trackedFeatures[e]=n,this._ctx.onFeatureUsage)try{this._ctx.onFeatureUsage(e,t)}catch(e){}I&&window.fetch&&(this._rtQueue.push({key:e,on:t.on}),this._rtTimer||(this._rtTimer=window.setTimeout(function(){r._rtTimer=0;var e=_toConsumableArray(r._rtQueue);r._rtQueue=[],r._ctx.realtimeKey&&window.fetch("https://rt.growthbook.io/?key=".concat(r._ctx.realtimeKey,"&events=").concat(encodeURIComponent(JSON.stringify(e))),{cache:"no-cache",mode:"no-cors"}).catch(function(){})},this._ctx.realtimeInterval||2e3)))}}}},{key:"_getFeatureResult",value:function(e,t,r,n,i,o){t={value:t,on:!!t,off:!t,source:r,ruleId:n||""};return i&&(t.experiment=i),o&&(t.experimentResult=o),this._trackFeatureUsage(e,t),t}},{key:"isOn",value:function(e){return this.evalFeature(e).on}},{key:"isOff",value:function(e){return this.evalFeature(e).off}},{key:"getFeatureValue",value:function(e,t){e=this.evalFeature(e).value;return null===e?t:e}},{key:"feature",value:function(e){return this.evalFeature(e)}},{key:"evalFeature",value:function(e){var t=this;if(this._forcedFeatureValues.has(e))return this.log("Global override",{id:e,value:this._forcedFeatureValues.get(e)}),this._getFeatureResult(e,this._forcedFeatureValues.get(e),"override");if(!this._ctx.features||!this._ctx.features[e])return this.log("Unknown feature",{id:e}),this._getFeatureResult(e,null,"unknownFeature");var r=this._ctx.features[e];if(r.rules){var n,i=_createForOfIteratorHelper(r.rules);try{for(i.s();!(n=i.n()).done;){var o=n.value;if(o.condition&&!this._conditionPasses(o.condition))this.log("Skip rule because of condition",{id:e,rule:o});else if(o.filters&&this._isFilteredOut(o.filters))this.log("Skip rule because of filters",{id:e,rule:o});else if("force"in o){if(this._isIncludedInRollout(o.seed||e,o.hashAttribute,o.range,o.coverage,o.hashVersion))return this.log("Force value from rule",{id:e,rule:o}),o.tracks&&o.tracks.forEach(function(e){t._track(e.experiment,e.result)}),this._getFeatureResult(e,o.force,"force",o.id);this.log("Skip rule because user not included in rollout",{id:e,rule:o})}else if(o.variations){var a={variations:o.variations,key:o.key||e},s=("coverage"in o&&(a.coverage=o.coverage),o.weights&&(a.weights=o.weights),o.hashAttribute&&(a.hashAttribute=o.hashAttribute),o.namespace&&(a.namespace=o.namespace),o.meta&&(a.meta=o.meta),o.ranges&&(a.ranges=o.ranges),o.name&&(a.name=o.name),o.phase&&(a.phase=o.phase),o.seed&&(a.seed=o.seed),o.hashVersion&&(a.hashVersion=o.hashVersion),o.filters&&(a.filters=o.filters),this._run(a,e));if(this._fireSubscriptions(a,s),s.inExperiment&&!s.passthrough)return this._getFeatureResult(e,s.value,"experiment",o.id,a,s)}else this.log("Skip invalid rule",{id:e,rule:o})}}catch(e){i.e(e)}finally{i.f()}}return this.log("Use default value",{id:e,value:r.defaultValue}),this._getFeatureResult(e,void 0===r.defaultValue?null:r.defaultValue,"defaultValue")}},{key:"_isIncludedInRollout",value:function(e,t,r,n,i){return!r&&void 0===n||!!(t=this._getHashAttribute(t).hashValue)&&null!==(e=T(e,t,i||1))&&(r?F(e,r):void 0===n||e<=n)}},{key:"_conditionPasses",value:function(e){return j(this.getAttributes(),e)}},{key:"_isFilteredOut",value:function(e){var n=this;return e.some(function(e){var t,r=n._getHashAttribute(e.attribute).hashValue;return!r||null===(t=T(e.seed,r,e.hashVersion||2))||!e.ranges.some(function(e){return F(t,e)})})}},{key:"_run",value:function(e,t){var r=e.key,n=e.variations.length;if(n<2)return this.log("Invalid experiment",{id:r}),this._getResult(e,-1,!1,t);if(!1===this._ctx.enabled)return this.log("Context disabled",{id:r}),this._getResult(e,-1,!1,t);e=this._mergeOverrides(e);i=r,a=this._getContextUrl(),o=n;var i,o=(a=a&&a.split("?")[1])&&0<(a=a.replace(/#.*/,"").split("&").map(function(e){return e.split("=",2)}).filter(function(e){return _slicedToArray(e,1)[0]===i}).map(function(e){e=_slicedToArray(e,2)[1];return parseInt(e)})).length&&0<=a[0]&&a[0]<o?a[0]:null;if(null!==o)return this.log("Force via querystring",{id:r,variation:o}),this._getResult(e,o,!1,t);if(this._ctx.forcedVariations&&r in this._ctx.forcedVariations)return a=this._ctx.forcedVariations[r],this.log("Force via dev tools",{id:r,variation:a}),this._getResult(e,a,!1,t);if("draft"===e.status||!1===e.active)return this.log("Skip because inactive",{id:r}),this._getResult(e,-1,!1,t);var a,s,o=this._getHashAttribute(e.hashAttribute).hashValue;if(!o)return this.log("Skip because missing hashAttribute",{id:r}),this._getResult(e,-1,!1,t);if(e.filters){if(this._isFilteredOut(e.filters))return this.log("Skip because of filters",{id:r}),this._getResult(e,-1,!1,t)}else if(e.namespace&&(a=o,s=e.namespace,!(null!==(a=T("__"+s[0],a,1))&&a>=s[1]&&a<s[2])))return this.log("Skip because of namespace",{id:r}),this._getResult(e,-1,!1,t);return e.include&&!function(e){try{return e()}catch(e){console.error(e)}}(e.include)?(this.log("Skip because of include function",{id:r}),this._getResult(e,-1,!1,t)):e.condition&&!this._conditionPasses(e.condition)?(this.log("Skip because of condition",{id:r}),this._getResult(e,-1,!1,t)):e.groups&&!this._hasGroupOverlap(e.groups)?(this.log("Skip because of groups",{id:r}),this._getResult(e,-1,!1,t)):e.url&&!this._urlIsValid(e.url)?(this.log("Skip because of url",{id:r}),this._getResult(e,-1,!1,t)):e.urlPatterns&&!ge(this._getContextUrl(),e.urlPatterns)?(this.log("Skip because of url targeting",{id:r}),this._getResult(e,-1,!1,t)):null===(a=T(e.seed||r,o,e.hashVersion||1))?(this.log("Skip because of invalid hash version",{id:r}),this._getResult(e,-1,!1,t)):(s=function(e,t){for(var r=0;r<t.length;r++)if(F(e,t[r]))return r;return-1}(a,e.ranges||_e(n,void 0===e.coverage?1:e.coverage,e.weights)))<0?(this.log("Skip because of coverage",{id:r}),this._getResult(e,-1,!1,t)):"force"in e?(this.log("Force variation",{id:r,variation:e.force}),this._getResult(e,void 0===e.force?-1:e.force,!1,t)):this._ctx.qaMode?(this.log("Skip because QA mode",{id:r}),this._getResult(e,-1,!1,t)):"stopped"===e.status?(this.log("Skip because stopped",{id:r}),this._getResult(e,-1,!1,t)):(o=this._getResult(e,s,!0,t,a),this._track(e,o),this.log("In experiment",{id:r,variation:o.variationId}),o)}},{key:"log",value:function(e,t){this.debug&&(this._ctx.log?this._ctx:console).log(e,t)}},{key:"_track",value:function(e,t){if(this._ctx.trackingCallback){var r=e.key,r=t.hashAttribute+t.hashValue+r+t.variationId;if(!this._trackedExperiments.has(r)){this._trackedExperiments.add(r);try{this._ctx.trackingCallback(e,t)}catch(e){console.error(e)}}}}},{key:"_mergeOverrides",value:function(e){var t=e.key,r=this._ctx.overrides;return r&&r[t]&&"string"==typeof(e=Object.assign({},e,r[t])).url&&(e.url=me(e.url)),e}},{key:"_getHashAttribute",value:function(e){var e=e||"id",t="";return this._attributeOverrides[e]?t=this._attributeOverrides[e]:this._ctx.attributes?t=this._ctx.attributes[e]||"":this._ctx.user&&(t=this._ctx.user[e]||""),{hashAttribute:e,hashValue:t}}},{key:"_getResult",value:function(e,t,r,n,i){var o=!0,a=((t<0||t>=e.variations.length)&&(t=0,o=!1),this._getHashAttribute(e.hashAttribute)),s=a.hashAttribute,a=a.hashValue,u=e.meta?e.meta[t]:{},n={key:u.key||""+t,featureId:n,inExperiment:o,hashUsed:r,variationId:t,value:e.variations[t],hashAttribute:s,hashValue:a};return u.name&&(n.name=u.name),void 0!==i&&(n.bucket=i),u.passthrough&&(n.passthrough=u.passthrough),n}},{key:"_getContextUrl",value:function(){return this._ctx.url||(I?window.location.href:"")}},{key:"_urlIsValid",value:function(e){var t,r=this._getContextUrl();return!!r&&(t=r.replace(/^https?:\/\//,"").replace(/^[^/]*\//,"/"),!!e.test(r)||!!e.test(t))}},{key:"_hasGroupOverlap",value:function(e){for(var t=this._ctx.groups||{},r=0;r<e.length;r++)if(t[e[r]])return!0;return!1}},{key:"_applyDOMChanges",value:function(e){var t,r,n;if(I)return t=[],e.css&&((r=document.createElement("style")).innerHTML=e.css,document.head.appendChild(r),t.push(function(){return r.remove()})),e.js&&((n=document.createElement("script")).innerHTML=e.js,document.body.appendChild(n),t.push(function(){return n.remove()})),e.domMutations&&e.domMutations.forEach(function(e){t.push(ve.declarative(e).revert)}),function(){t.forEach(function(e){return e()})}}}]),r}();"function"==typeof window.gtag&&window.CoderPad.ga4_tracking_id&&window.CoderPad.growthbook_client_id&&gtag("get",window.CoderPad.ga4_tracking_id,"client_id",function(e){var r;r=e,new Se({apiHost:"https://cdn.growthbook.io",clientKey:window.CoderPad.growthbook_client_id,enableDevMode:window.CoderPad.growthbook_dev_mode,attributes:{id:r},trackingCallback:function(e,t){gtag("event","experiment_viewed",{event_category:"experiment",experiment_id:e.key,variation_id:t.variationId,gb_user_id:r})}}).loadFeatures().then(function(){})})}();